from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    CallbackQueryHandler,
    ContextTypes,
    filters,
)

# Данные о рецептах
countries_data = {
    'Американская': {
        'Американские классические панкейки': {
            'ingredients': [
                'Пшеничная мука 2 стак',
                'Молоко 300 мл',
                'Яйца 2 шт',
                'Сахар 3 стол.л',
                'Соль по вкусу',
                'Разрыхлитель 1 чайн.л.',
                'Ванильный сахар 1 чайн.л.',
                'Растительное масло 100 мл'
            ],
            'steps': [
                'Яйцо помойте, разбейте в миску, добавьте сахар и ванильный сахар. Взбейте венчиком или миксером.',
                'Подогрейте молоко, влейте его в яичную массу, добавьте растительное масло. Перемешайте до однородности.',
                'Постепенно просейте муку с солью и разрыхлителем. Перемешайте тесто, чтобы не было комочков. Консистенция должна быть, как густая сметана.',
                'Разогрейте сковороду. Для первой порции смажьте её каплей масла, затем жарьте без него.',
                'Выливайте ложкой тесто, жарьте 2–3 минуты, пока поверхность панкейка не покроется дырочками. Переверните и обжарьте 1–2 минуты.',
                'Подавайте панкейки с мёдом, джемом, сметаной или любимыми топингами.'
            ],
            'image_url': 'https://static.1000.menu/img/content-v2/62/80/8139/pankeiki_1606377927_13_max.jpg',
            'facts': 'Панкейки — традиционное блюдо американской кухни, популярное на завтрак. Их подают с разнообразными сиропами и свежими фруктами.'
        },

        'Американский бургер': {
            'ingredients': [
                'Булочки для бургеров - 6 шт',
                'Фарш из телятины - 600 г',
                'Помидоры свежие - 2 шт. (300 г)',
                'Огурчики (корнишоны) соленые - 4 шт. (100 г)',
                'Сыр для бутербродов, в индивидуальных пластинах - 6 шт',
                'Салат листовой - 1 пучок (100 г)',
                'Чесночный соус - 2 ст. л. (100 г)',
                'Соль - по вкусу',
                'Перец черный молотый - по вкусу',
                'Специи для мяса - по вкусу',
                'Масло растительное'
            ],
            'steps': [
                'Разрежьте булочки пополам, помидоры нарежьте кружочками, огурцы – тонкими ломтиками.',
                'Смешайте фарш с солью и перцем, разделите на 6 равных частей, сформируйте котлеты.',
                'Разогрейте сковороду-гриль, слегка смажьте её маслом, обжарьте котлеты с обеих сторон до готовности.',
                'Соберите бургер: нижнюю половину булочки смажьте соусом, добавьте котлету, сверху положите ломтик сыра, кружок помидора, ломтики огурца и лист салата.',
                'Накройте верхней половиной булочки, слегка прижмите. Повторите для остальных бургеров.'
            ],
            'image_url': 'https://avatars.mds.yandex.net/get-entity_search/1671503/935816736/S600xU_2x',
            'facts': 'Классический американский бургер появился в начале XX века и стал символом быстрого питания. Его популярность связана с сочетанием простоты приготовления и насыщенного вкуса.'
        },

        'Американский яблочный пирог': {
            'ingredients': [
                'Мука пшеничная – 270 г',
                'Масло сливочное – 270 г',
                'Соль – 1 щепотка',
                'Корица – 2 ч.л.,'
                'Сахар – 180 г',
                'Крахмал кукурузный – 2 ст.л.',
                'Сок лимонный – 4 ст.л.',
                'Яблоко – 800 г',
                'Вода – 120 мл',
                'Яйцо – 1 шт.'
            ],
            'steps': [
                'В миске смешайте муку, сахар, соль и корицу. Добавьте холодное масло, нарезанное кубиками, и разотрите до состояния крошки.',
                'Постепенно добавляйте ледяную воду, пока тесто не начнет склеиваться. Замесите, заверните в пленку и охладите 1 час.',
                'Яблоки нарежьте, варите с водой и лимонным соком 10–15 минут. Добавьте крахмал, сахар, корицу, перемешайте и варите до загустения. Остудите.',
                'Раскатайте большую часть теста (3–4 мм), выложите в форму, разровняйте по дну и бортикам.',
                'Выложите яблочную начинку. Из оставшегося теста сделайте решетку или накройте пирог пластом с отверстиями для пара.',
                'Смажьте пирог яйцом, посыпьте сахаром. Выпекайте 20 минут при 220°C, затем ещё 40 минут при 175°C.'
            ],
            'image_url': 'https://img.povar.ru/main-micro/3e/52/91/c4/sharlotka_s_yablokami_i_koricei-65644.jpg',
            'facts': 'Американский яблочный пирог — символ традиционного домашнего уюта в США. Его популярность связана с простотой рецепта и ярким вкусом сочных яблок.'
        }
    },
    'Грузинская': {
        'Хинкали по-грузински': {
            'ingredients': [
                'Пшеничная мука - 500 г',
                'Вода - 250 мл',
                'Соль (без горки) - 1 ч.л.',
                'Говядина - 500 г',
                'Лук репчатый - 2 шт.',
                'Вода (холодная) - 500 мл',
                'Зелень кинзы - 1 пучок',
                'Петрушка - по вкусу',
                'Специи сухие - по вкусу',
                'Перец красный молотый - по вкусу',
                'Перец черный молотый - по вкусу',
                'Соль - по вкусу'
            ],
            'steps': [
                'Муку просейте на рабочую поверхность, сделайте углубление в центре, всыпьте соль. Вливайте воду понемногу, перемешивая вилкой, пока вся мука не соберется в комок.',
                'Замесите тесто руками, подсыпая муку по необходимости, чтобы тесто не прилипало. Заверните готовое тесто в пакет и оставьте на 2 часа "отдыхать".',
                'Для фарша: перекрутите мясо через мясорубку вместе с луком. Добавьте зелень, специи, соль и холодную воду, вымешивая фарш до жидкой консистенции.',
                'Скатайте тесто в колбаску, нарежьте на одинаковые куски. Каждый кусок раскатайте в круг толщиной 2 мм и размером с ладонь. Сделайте края тоньше центра.',
                'На каждый круг теста положите столовую ложку фарша. Соберите края теста складочками в центр, соедините и слегка закрутите хвостик.',
                'Доведите до кипения воду в кастрюле, добавьте соль. Опустите хинкали в кипяток, перемешивайте, чтобы они не прилипли ко дну. Варите 14 минут.',
                'Выньте хинкали шумовкой, выложите на тарелку и подавайте горячими.'
            ],
            'image_url': 'https://static.1000.menu/img/content-v2/f8/e0/15509/xinkali_1616735959_20_max.jpg',
            'facts': 'Хинкали — это традиционное грузинское блюдо, которое отличается особой техникой лепки и наличием сочного бульона внутри. Обычно едят руками, держа за хвостик.'
        },

        'Хачапури по-аджарски': {
            'ingredients': [
                'Слоёное тесто - 800 г',
                'Яйца (для смазывания) - 1 шт.',
                'Сулугуни - 600 г',
                'Сливочное масло - 100 г',
                'Яйца - 4 шт.'
            ],
            'steps': [
                'Сыр натрите на крупной терке. Для хачапури лучше использовать оригинальный грузинский сыр, то есть сулугуни. Но можно заменить его на другие сорта.',
                'Каждую пластину теста раскатайте на присыпанном мукой столе в прямоугольник размером 30×40 см. Обрежьте углы прямоугольника, закругляя стороны.',
                'Смажьте края теста взбитым яйцом. По длинным сторонам разложите по 50 г тертого сыра. Сверните стороны с сыром навстречу друг другу, формируя лодочку. Сыр окажется внутри бортиков хачапури.',
                'Переложите заготовки на застеленный пергаментом противень. Бортики лодочек смажьте взбитым яйцом, а дно наколите вилкой, чтобы оно не поднималось.',
                'Поставьте заготовки в разогретую до 220-230°C духовку примерно на 10 минут, пока не появится легкая румяная корочка.',
                'В середину хачапури распределите по 50 г сыра, сделайте углубление в центре и аккуратно разбейте по одному яйцу, чтобы желток оказался в центре. Верните в духовку еще на 5-7 минут, чтобы белок загустел, а желток остался жидким.',
                'Готовые хачапури достаньте из духовки и смажьте бортики сливочным маслом. Внутрь лодочек разложите кусочки масла по бокам от яйца. Подавайте горячими. Приятного аппетита!'
            ],
            'image_url': 'https://avatars.mds.yandex.net/get-entity_search/2357591/990678133/S600xU_2x',
            'facts': 'Хачапури по-аджарски — одно из самых популярных блюд грузинской кухни. Характерная форма "лодочки" с яйцом и сыром делает его незабываемым!'
        },
    },
    'Мексиканская': {
        'Тако с Карне Асадой': {
            'ingredients': [
                'Для маринада:',
                '2-3 зубчика чеснока, нарезанные',
                '1 ч.л. свежемолотого перца',
                '1 ч.л. кошерной соли',
                '½ ч.л. мексиканского орегано',
                'Сок 1 большого лайма',
                '¼ стакана (60 мл) оливкового масла',
                '',
                'Для соуса из авокадо:',
                '1 маленький авокадо (сорт Хасс)',
                '1 перец серрано, нарезанный',
                '1 ст.л. кинзы',
                '1 ст.л. белого лука',
                'Сок ½ лайма',
                '1/3 стакана (80 мл) + 2 ч.л. холодной воды',
                'Соль по вкусу',
                '',
                'Прочее:',
                '500 г тонкого стейка',
                '18 маленьких кукурузных лепешек',
                '1 маленькая белая луковица, мелко нарезанная',
                '1/3 стакана (20 г) кинзы, нарезанной',
                '½ стакана (60 г) редиса, нарезанного ломтиками',
                '2 лайма, нарезанные на дольки'
        ],
            'steps': [
                'В блендере смешайте все ингредиенты для маринада до однородной массы. Переложите стейк в пластиковый пакет, залейте маринадом и закройте. Маринуйте в холодильнике 2 часа.',
                'Очистите блендер, добавьте ингредиенты для соуса из авокадо. Взбейте до кремовой консистенции, добавьте соль по вкусу. Переложите соус в миску, накройте пленкой и уберите в холодильник.',
                'Нарежьте лук, кинзу и редис. Лаймы разрежьте на дольки. Уберите все в холодильник до подачи.',
                'Достаньте мясо из холодильника за 40–50 минут до готовки. Разогрейте гриль до средней/высокой температуры. Очистите мясо от излишков маринада и готовьте 7–10 минут, переворачивая на середине процесса.',
                'После готовки дайте мясу отдохнуть 5–7 минут, накрыв фольгой. Разогрейте лепешки.',
                'Нарежьте мясо на тонкие полоски, затем на небольшие кусочки. Соберите тако, складывая две лепешки, добавьте мясо, соус из авокадо, лук, кинзу, редис и лайм.'
            ],
            'image_url': 'https://www.tasteatlas.com/images/recipes/d2f9d1143d3f4e0db65ddc362a3e24c5.jpg?mw=910',
            'facts': 'Carne Asada Tacos — традиционное мексиканское блюдо, известное своим насыщенным вкусом, маринованным мясом и свежими овощами.'
        }


    },
    'Индийская': {
        'Сливочно - чесночный Наан': {
            'ingredients': [
                '2 ч.л. (7г) сухих дрожжей',
                '120 мл тёплой воды',
                '300 г муки',
                '1 ч.л. сахара',
                '0.5 ч.л. разрыхлителя',
                '1 ч.л. соли',
                '150 мл натурального йогурта',
                '75 г топлёного масла (гхи)',
                '2 зубчика чеснока',
                '2 ч.л. сушёного кориандра (или 4 ч.л. свежего кориандра)'
            ],
            'steps': [
                'Добавьте дрожжи в тёплую воду, перемешайте и оставьте на 5 минут.',
                'Смешайте муку, сахар, разрыхлитель, соль, дрожжевую смесь и йогурт в миске.',
                'Замесите тесто, дайте ему подняться 60-90 минут.',
                'Разделите тесто на 6 частей, раскатайте в форму капли.',
                'Обжарьте каждый наан на сковороде 3 минуты с каждой стороны.',
                'Смажьте топлёным маслом с чесноком и кориандром.'
            ],
            'image_url': 'https://www.tasteatlas.com/images/recipes/3ade4de5e6564edbae502d6eb9703e98.jpg?mw=910',
            'facts': 'Наан - традиционная индийская лепёшка, часто подаётся с карри или другими блюдами.'
        },
        'Ладду из сухофруктов': {
            'ingredients': [
                '150 г изюма',
                '150 г кураги',
                '100 г орехов',
                '3 ст.л. кунжута',
                '2 ст.л. кокосовой стружки'
            ],
            'steps': [
                'Обжарьте орехи на сухой сковороде.',
                'Обжарьте кунжут.',
                'Измельчите орехи и сухофрукты.',
                'Добавьте кунжут и кокосовую стружку, перемешайте.',
                'Сформируйте шарики и обваляйте в кокосовой стружке.'
            ],
            'image_url': 'https://avatars.dzeninfra.ru/get-zen_doc/3986710/pub_6255d47bb4b9ba7894759b96_6255d4f38eecdd291efe5def/smart_crop_516x290',
            'facts': 'Ладду - популярное индийское сладкое, готовится для праздников и религиозных обрядов.'
        },
        'Палак Мунг Дал': {
            'ingredients': [
                '1 стакан маша (мунг)',
                '280 г красного лука',
                '20 г имбиря',
                '25 г чеснока',
                '25 мл растительного масла',
                '2.5 г куркумы',
                '5 г тмина',
                '15 г молотого кориандра',
                '3 г чёрного молотого перца',
                '10 г перца чили',
                '5 г соли',
                '150 г помидоров',
                '400 г шпината'
            ],
            'steps': [
                'Замочите маш на пару часов и отварите до полуготовности.',
                'Обжарьте лук, имбирь и чеснок в масле.',
                'Добавьте специи и соль, перемешайте.',
                'Добавьте нарезанные помидоры и тушите до размягчения.',
                'Добавьте шпинат и маш, готовьте ещё 6 минут.'
            ],
            'image_url': 'https://static.1000.menu/img/content/19196/-mash-mung-palak-mung-dal-mash-so-shpinatom-po-indiiski_1488249841_1_max.jpg',
            'facts': 'Палак Мунг Дал - питательное блюдо, популярное в северной Индии, сочетает в себе полезность бобовых и зелени.'
        }
    },

    'Итальянская': {
        'Пицца Маргарита': {
            'ingredients': [
                '1 литр воды (4 1/4 стакана)',
                '40–60 г соли',
                '3 г свежих дрожжей',
                '1,6–1,8 кг муки типа 00',
                '60–80 г консервированных очищенных помидоров',
                '6–7 г оливкового масла',
                '80–100 г моцареллы/фьор ди латте',
                'Несколько листьев базилика',
                '5–7 г тертого твердого сыра (по желанию)'
            ],
            'steps': [
                'Растворите соль в воде, добавьте дрожжи и размешайте.',
                'Постепенно добавляйте муку, замешивайте тесто 15–30 минут.',
                'Сформируйте шар, накройте тканью и оставьте на 2 часа.',
                'Сформируйте шары из теста весом 200–280 г, оставьте подходить ещё на 6 часов.',
                'Раскатайте тесто в диск с тонким центром и приподнятым краем.',
                'Разложите помидоры, моцареллу, тертый сыр, листья базилика и полейте оливковым маслом.',
                'Выпекайте в дровяной печи 60–90 секунд при 485°C, вращая пиццу для равномерной готовности.'
            ],
            'image_url': 'https://www.tasteatlas.com/images/recipes/a99232294df34cc49be27526f6de291d.jpg?mw=910',
            'facts': 'Традиционная итальянская пицца Маргарита символизирует цвета итальянского флага: базилик (зелёный), помидоры (красный) и моцарелла (белый).'
        },
        'Паста Фетучини с курицей': {
            'ingredients': [
                '300 г фетучини',
                '200 г замороженных грибов',
                '200 г куриного филе',
                '1 луковица',
                '4 зубчика чеснока',
                '0.5 стакана сливок',
                '0.5 стакана воды',
                '1 ч.л. крахмала',
                '20 г растительного масла',
                'Соль по вкусу',
                'Специи сухие по вкусу'
            ],
            'steps': [
                'Разогрейте сковороду и налейте растительное масло. Нарежьте куриное филе на небольшие кусочки и обжаривайте 5–7 минут до золотистого цвета.',
                'Мелко нарежьте лук, добавьте его к курице и обжаривайте 2–3 минуты.',
                'Добавьте размороженные грибы, обжаривайте 2–3 минуты, затем накройте крышкой и тушите на слабом огне 10 минут, периодически помешивая.',
                'Смешайте холодную воду с крахмалом, добавьте соль и специи по вкусу. Влейте смесь в сковороду и доведите до кипения, пока соус не загустеет.',
                'Добавьте готовую пасту в сковороду, перемешайте и прогрейте 2–3 минуты, чтобы все ингредиенты стали одной температуры.'
            ],
            'image_url': 'https://здоровое-питание.рф/upload/iblock/6a2/s9gmf27dxsnbjvoap4btpytvdrwikpnh/Pasta-fetuchini-kuritsa-s-gribami-v-slivochnom-souse-5.jpg',
            'facts': 'Фетучини – традиционная итальянская паста, популярная в Риме и Лацио. Грибы и сливочный соус придают блюду нежный вкус, идеально дополняя курицу.'
        },

        'Трубочки Канноли': {
            'ingredients': [
                '160 г пшеничной муки',
                '1 ст.л. сахарной пудры',
                '1 ч.л. молотой корицы',
                '40 г сливочного масла',
                '3 ст.л. белого вина',
                '300 г рикотты',
                '100 г сахара или сахарной пудры',
                '100 г жирных сливок (30%)',
                '10 г цукатов (по желанию)',
                '1 яичный белок',
                '5 ст.л. растительного масла (для жарки)',
                '10 г шоколада (по желанию)',
                '10 г фисташек (по желанию)',
                '10 г сахарной пудры (для украшения)'
            ],
            'steps': [
                'Смешайте муку, сахарную пудру, корицу и холодное масло до состояния крошки. Добавьте вино, замесите тесто, заверните в пленку и охладите 45-60 минут.',
                'Для крема: смешайте рикотту, сахар и взбитые сливки. Добавьте цукаты, фисташки или шоколад по желанию.',
                'Раскатайте тесто толщиной 1-2 мм, вырежьте круги диаметром 7-8 см, оберните их вокруг металлических трубочек, скрепив края белком.',
                'Обжаривайте трубочки в разогретом до 180°C масле 30 секунд до золотистого цвета. Остудите.',
                'Наполните трубочки охлажденным кремом, украсьте сахарной пудрой, шоколадом или фисташками.'
            ],
            'image_url': 'https://static.1000.menu/img/content/16139/siciliiskie-kannoli_1463500208_0_max.jpg',
            'facts': 'Канноли — классический десерт Сицилии, известный своим хрустящим тестом и нежной рикоттой. Часто подается на праздники и особые события.'
        }
    },

    'Русская': {
        'Блины': {
            'ingredients': [
                'Мука - 2 стакана',
                'Молоко - 500 мл',
                'Яйца - 2 шт.',
                'Сахар - 1 ст. л.',
                'Соль - 1/2 ч. л.',
                'Растительное масло - 2 ст. л.'
            ],
            'steps': [
                'В большой миске смешайте яйца, сахар и соль.',
                'Постепенно добавляйте молоко, перемешивая венчиком.',
                'Постепенно всыпьте просеянную муку, постоянно размешивая, чтобы избежать комочков.',
                'Добавьте растительное масло и тщательно перемешайте тесто.',
                'Разогрейте сковороду и слегка смажьте её растительным маслом.',
                'Налейте небольшое количество теста на сковороду и равномерно распределите его.',
                'Жарьте блины на среднем огне до золотистого цвета с обеих сторон.',
                'Подавайте горячими с мёдом, сметаной или вареньем.'
            ],
            'image_url': 'https://irecommend.ru/sites/default/files/product-images/1471741/DwbZfI071IzYwdQgF2qyYg.jpeg',
            'facts': 'Блины — традиционное русское блюдо, которое часто подают на Масленицу. Их можно готовить с разнообразными начинками или подавать с топингами.'
        },

        "Окрошка на минералке": {
            "ingredients": [
                "Картофель - 3 шт.",
                "Огурцы свежие - 2 шт.",
                "Яйца - 3 шт.",
                "Колбаса варёная - 300 г",
                "Редис - 6-8 шт.",
                "Минеральная вода - 1 литр",
                "Сметана - 100 мл ",
                "Горчица - 1 ч.л.",
                "Зелёный лук - 1 пучок",
                "Укроп - 1 пучок",
                "Соль, перец - по вкусу"
            ],
            "steps": [
                "Отварите картофель в мундире, остудите, очистите и нарежьте кубиками.",
                "Яйца отварите вкрутую, остудите, очистите и нарежьте кубиками.",
                "Колбасу или отварное куриное филе нарежьте мелкими кубиками.",
                "Огурцы и редис вымойте и нарежьте мелкими кубиками.",
                "Мелко нарежьте зелёный лук и укроп.",
                "Смешайте все ингредиенты в большой миске.",
                "Залейте ингредиенты охлаждённой минеральной водой, добавьте соль и перец по вкусу. ",
                "При желании добавьте сметану и горчицу, хорошо перемешайте.",
                "Подавайте охлаждённой, украсив свежей зеленью."
            ],
            "image_url": "https://cdn.botanichka.ru/wp-content/uploads/2018/07/okroshka-s-kolbasoy-na-ovoshhnom-bulone-13.jpg",
            "facts": "Окрошка на минералке - это лёгкое и освежающее блюдо, идеально подходящее для жаркого дня. Её можно приготовить с колбасой или отварным куриным филе."
        }
    },
    'Казахская': {
        'Бешбармак': {
            'ingredients': [
                'Мясо (баранина, говядина, конина) - 1 кг',
                'Лук репчатый - 2-3 шт',
                'Масло сливочное (для соуса) - 150 г',
                'Чеснок - 2 зубчика',
                'Соль',
                'Перец чёрный',
                
                'Для теста:',
                'Яйцо - 1-2 шт',
                'Мука - 500 г',
                'Вода  - 200 мл',
                'Масло растительное - 15 мл',
                'Соль - 0,5 ч. ложки'
            ],
            'steps': [
                'Варим мясо в бульоне со специями: головка лука, чеснок, черный перец, соль. Время приготовления мяса составляет 2-2,5 часа на медленном огне. Необходимо, чтобы оно отделялось от костей и распадалось на части',
                'В это время замешиваем тесто (см. ниже). Рабочую поверхность слегка подпыляем мукой. Для удобства тесто лучше разделить на несколько частей. Часть теста раскатываем в тонкий пласт, чтобы сквозь него был виден стол, и разрезаем на ромбики.',
                'Готовое мясо достаем из бульона и рвем на небольшие кусочки, при желании можно оставить огромными кусками.',
                'В кипящий мясной бульон кидаем тесто и варим около 15 минут.',
                'Выкладываем на тарелку слоями: тесто, мясо, соус с луком. Перчим. Подаём с бульоном.'
            ],
            'image_url': 'https://avatars.mds.yandex.net/i?id=0efd3941f435c647794a3de8daecb753_l-5232263-images-thumbs&n=13',
            'facts': 'Бешбармак — традиционное блюдо казахской кухни, которое означает "пять пальцев". Его едят руками, что символизирует единение.'
        },

        'Баурсаки': {
            'ingredients': [
                'Мука - 4 стакана',
                'Простокваша - 1 стакан',
                'Дрожжи - 1 ст. ложка',
                'Сахар - 1 ст. ложка (если хотите баурсаки сделать сладкими, добавьте 3 ложки сахара)',
                'Соль - щепотка',
                'Масло растительное - 400 г'
            ],
            'steps':[
                'Замесить тесто для баурсаков: в простокваше распустить сахар и дрожжи, добавить муку, соль и вымесить тесто в шар.',
                'Поставить миску с тестом в теплое место и накрыть полотенцем. Оставить минимум на 5 часов.',
                'Стол и руки смазать растительным маслом. Тесто вывалить на стол и хорошо вымесить.',
                'Разделить тесто на небольшие кусочки. Скатать эти кусочки в шарики и оставить на столе минут на пять, чтобы они поднялись.',
                'Разогреть в кастрюльке масло. Шарики, по одному, выкладывать в масло, помешивая сухой ложкой.',
                'Жарить на среднем огне, постоянно помешивая, чтобы баурсаки равномерно подрумянивались со всех сторон.'
            ],
            'image_url': 'https://avatars.mds.yandex.net/i?id=3a285601e9664b18aab4cc6c48574782c3a6142d-9701523-images-thumbs&ref=rim&n=33&w=375&h=250',
            'facts': 'Баурсаки — традиционная выпечка казахской кухни, которая символизирует гостеприимство и часто подаётся на праздничный стол.'
        },

        'Сорпа (казахский суп)': {
            'ingredients': [
                'Морковь - 2 шт.',
                'Баранина (грудинка) - 600 г',
                'Лук репчатый - 2 шт.',
                'Лавровый лист - 2 шт.',
                'Зелень - 3 г',
                'Перец горошком - по вкусу',
                'Соль - по вкусу'
            ],
            'steps': [
                'Тщательно промойте мясо в холодной воде.',
                'Положите мясо в кастрюлю, залейте кипящей водой и варите 1-1.5 часа на медленном огне.',
                'После закипания снимите пену и излишки жира с бульона.',
                'Соль добавьте в конце варки. Готовность мяса проверьте вилкой — если вилка легко прокалывает мясо, оно готово.',
                'Добавьте к мясу морковь, мелко нарезанный репчатый лук, перец горошком, лавровый лист.',
                'Продолжайте варить содержимое до полной готовности овощей и мяса.',
                'Бульон процедите и налейте в глубокую тарелку, добавьте мясо.'
            ],
            'image_url': 'https://static.tildacdn.com/tild3336-6636-4139-b135-373965623564/___.jpg',
            'facts': 'Сорпа — это традиционный казахский бульон, который подается с мясом и овощами. Его готовят на праздники и семейные обеды.'
         },
        'Жент': {
            'ingredients': [
                'Сахар - 200 г',
                'Пшено - 500 г',
                'Изюм - 125 г',
                'Сливочное масло (82.5%) - 200 г'
            ],
            'steps': [
                'Промойте пшено в теплой проточной воде, пока она не станет прозрачной.',
                'Разогрейте сухую сковороду на плите. Слейте воду с пшена и обжарьте его, постоянно перемешивая, до красноватого цвета (около 20 минут).',
                'Засыпьте обжаренное пшено в блендер. Добавьте сахар и измельчите смесь до состояния муки.',
                'Пересыпьте измельченную муку в емкость для замешивания. Добавьте промытый и обсушенный изюм.',
                'Растопите сливочное масло любым способом. Порциями вливайте масло в сухую смесь, вымешивая до однородного состояния.',
                'Переложите полученную массу в полиэтиленовый пакет, хорошо уплотните руками, сформируйте квадратный коржик.',
                'Уберите пакет в холодильник для застывания примерно на полтора часа.',
                'Достаньте Жент из пакета, выложите на разделочную доску и нарежьте на небольшие части.',
                'Выложите десерт на сервировочную тарелку и подавайте к чаю.'
            ],
            'image_url': 'https://i.ytimg.com/vi/w_hWKaH4Mi8/maxresdefault.jpg',
            'facts': 'Жент — это традиционный казахский десерт из пшена, сахара, изюма и сливочного масла. Его готовят к чаю, и он популярен на семейных мероприятиях и праздниках.'
        },
    },
    'Турецкая': {
        'Традиционное мороженое Мараш Дондурумасы': {
            'ingredients': [
                '3 г (1 ч.л.) мастиковых зерен',
                '65 г (⅓ стакана) смеси салепа',
                '750 мл (3 стакана) молока',
                '250 мл (1 стакан) сливок',
                '165 г (¾ стакана) сахарной пудры',
                'Молотая корица и мелко нарезанные фисташки для украшения'
            ],
            'steps': [
                'Положите мастиковые зерна в морозильник на 15 минут. Затем смешайте их с щепоткой сахара и мелко измельчите с помощью ступки или мельницы для специй.',
                'Растворите смесь салепа в 125 мл (½ стакана) молока.',
                'Возьмите большую сковороду, добавьте сливки и оставшиеся 625 мл (2 ½ стакана) молока. Нагревайте на среднем огне, добавьте измельченную мастику и растворенную смесь салепа, тщательно перемешайте.',
                'Начните "вытягивать" смесь: зачерпните немного массы половником и выливайте обратно в сковороду с высоты. Повторяйте эту процедуру в течение 20 минут, пока смесь не станет густой. Для получения еще более вязкой текстуры продолжайте вытягивание еще 20 минут.',
                'Перелейте смесь в миску, накройте пленкой и дайте остыть.',
                'После остывания взбейте смесь в мороженице до состояния полу-замороженности.',
                'Переложите мороженое в слегка смазанную форму для хлеба, выложенную пленкой. Накройте пленкой и заморозьте на ночь.',
                'За 5 минут до подачи достаньте мороженое из морозильника. Уберите пленку, нарежьте мороженое ломтиками толщиной 3 см и выложите на десертные тарелки. Украсьте корицей и фисташками.'
            ],
            'image_url': 'https://www.tasteatlas.com/maras-dondurmas',
            'facts': 'Мараш Дондурумасы – традиционное турецкое мороженое с уникальной жевательной текстурой благодаря добавлению мастики и салепа.'
        },

        'Долма': {
            'ingredients': [
                'Виноградные листья - 300 г',
                'Мясной фарш - 1 кг',
                'Круглый рис - 1 стакан',
                'Репчатый лук - 1 шт.',
                'Чеснок - 4 зубчика',
                'Соль - по вкусу',
                'Специи (кориандр, мята, чёрный перец, красный острый перец) - по вкусу',
                'Зелень (кинза, петрушка, укроп, мята) - по вкусу',
                'Мацони (или сметана) - 400 мл'
            ],
            'steps': [
                'Подготовьте виноградные листья: залейте их кипятком на 5 минут (свежие) или на 20 минут (маринованные).',
                'В миске смешайте фарш, сырой рис, мелко нарезанные лук, чеснок и зелень. Добавьте соль и специи, тщательно перемешайте.',
                'На дно кастрюли выложите слой виноградных листьев, чтобы долма не пригорела.',
                'Сформируйте из начинки небольшую "котлетку" и заверните её в виноградный лист. Заворачивайте неплотно, чтобы листья не лопнули при варке.',
                'Выкладывайте долму в кастрюлю швом вниз, плотно по кругу.',
                'Залейте долму кипятком, чтобы она была полностью покрыта. Положите сверху груз, чтобы листья не разворачивались.',
                'Тушите долму на медленном огне 1 час после закипания.',
                'Приготовьте соус: процедите мацони через ткань, смешайте с чесноком и зеленью.',
                'Подавайте горячую долму с соусом, украсив зеленью или гранатовыми зернами.'
            ],
            'image_url': 'https://static.1000.menu/img/content-v2/23/e2/15111/klassicheskaya-dolma-v-vinogradnyx-listyax-v-kastrule_1613813760_15_max.jpg',
            'facts': 'Долма — традиционное турецкое блюдо, популярное на Кавказе и в Средиземноморье. Её готовят из фарша, завернутого в виноградные листья, с добавлением специй и зелени.'
        }

    },
    'Японская': {
        'Нигири суши': {
            "ingredients": [
                "2 чашки (380 г) риса для суши",
                "2 чашки (480 мл) воды",
                "3 ст. л. рисового уксуса",
                "2 ст. л. сахара",
                "1 ч. л. соли",
                "60 г тунца сорта 'суши'",
                "Соевый соус, для подачи",
                "Васаби, для подачи",
                "Маринованный имбирь, для подачи"
            ],
            "steps": [
                "Промойте рис для суши в холодной воде до тех пор, пока вода не станет прозрачной.",
                "Смешайте промытый рис с водой в кастрюле или рисоварке. Готовьте под крышкой на слабом огне 20 минут.",
                "Пока рис готовится, смешайте рисовый уксус, сахар и соль в небольшой миске, пока сахар полностью не растворится.",
                "Переложите готовый рис в плоскую ёмкость. Постепенно добавляйте заправку для риса, аккуратно перемешивая рис, пока он не остынет до комнатной температуры.",
                "На разделочной доске нарежьте рыбу тонкими ломтиками под углом 30-45° против волокон. Каждый ломтик должен быть шириной около 1,25 см и длиной 5 см.",
                "Смочите руки в миске с водой 'тезу' (вода с небольшим количеством уксуса). Сформируйте из риса небольшие овальные 'поленья', каждое весом не более 25 г.",
                "Положите ломтик рыбы на основание пальцев, добавьте небольшую каплю васаби в центр ломтика.",
                "Разместите сформированный рис сверху рыбы, слегка надавив большим пальцем и поддерживая края риса другими пальцами. Переверните заготовку и немного подкорректируйте форму.",
                "Разложите нигири на тарелке с небольшим количеством васаби и маринованного имбиря. Подавайте с соевым соусом."
            ],
            'image_url': 'https://media.baamboozle.com/uploads/images/142775/1626352412_122524_url.jpeg',
            'facts': 'Нигири суши появились в начале 19-го века в Японии, когда из-за индустриализации и роста городов люди искали быстрое и питательное блюдо. Их изобрёл Ханая Ёхэй, который придумал выкладывать рыбу на приправленный уксусом рис. Это сделало суши удобной уличной едой, которая быстро завоевала популярность.    '

        }
    },
    'Узбекская': {
        'Узбекский плов': {
            'ingredients': [
                'Рис (длиннозёрный, например, басмати) – 500 г',
                'Мясо (баранина или говядина) – 500 г',
                'Лук репчатый – 3 шт.',
                'Морковь – 500 г',
                'Растительное масло – 150 мл',
                'Чеснок – 1 головка',
                'Зира – 1 ч. л.',
                'Барбарис (сушёный) – 1 ч. л.',
                'Перец чёрный молотый – по вкусу',
                'Соль – по вкусу',
                'Вода – 1 литр'
            ],
            'steps': [
                'Промойте рис несколько раз в холодной воде, пока вода не станет прозрачной. Затем залейте его тёплой водой и оставьте на 30 минут.',
                'Мясо нарежьте небольшими кусочками.',
                'Морковь натрите на крупной тёрке или нарежьте соломкой.',
                'Лук нарежьте тонкими полукольцами.',
                'Головку чеснока оставьте целой, только удалите внешний слой шелухи.',
                'В казане нагрейте растительное масло. Обжарьте кусочки мяса до золотистой корочки.',
                'Добавьте в казан лук и жарьте его до прозрачности. Затем положите морковь и обжаривайте всё вместе 5–7 минут.',
                'Добавьте зиру, барбарис, соль и перец. Перемешайте. Влейте 500 мл воды, доведите до кипения. Варите зирвак на среднем огне 15–20 минут.',
                'Аккуратно выложите рис поверх мяса и овощей. Не перемешивайте. Залейте оставшейся водой (она должна полностью покрывать рис). Установите головку чеснока в центр.',
                'Готовьте плов на среднем огне, пока вода не впитается в рис. Затем уменьшите огонь до минимума, накройте казан крышкой и готовьте ещё 20–25 минут.',
                'Снимите казан с огня, осторожно перемешайте плов, чтобы не повредить зёрна риса. Дайте ему настояться под крышкой 10 минут.'
            ],
            'image_url': 'https://blog.ostrovok.ru/wp-content/uploads/2019/06/uz_221.jpg',
            'facts': 'Узбекский плов – это не просто блюдо, а символ дружбы и гостеприимства. В Узбекистане его готовят на свадьбы и другие важные мероприятия, где за одним столом собирается множество гостей.'
        }
    },
    'Корейская': {
        "Токпокки": {
            "ingredients": [
                "Рисовые палочки (tteok) – 500 г",
                "Рыбные пирожки (eomuk), нарезанные – 200 г",
                "Зеленый лук, нарезанный – 2 стебля",
                "Вода – 600 мл",
                "Гочуджан (паста из острого перца) – 3 ст. л.",
                "Гочугару (хлопья красного перца) – 1 ст. л.",
                "Соевый соус – 2 ст. л.",
                "Сахар – 1 ст. л.",
                "Чеснок, измельченный – 2 зубчика",
                "Растительное масло – 1 ст. л.",
                "Вареное яйцо – 2 шт. (по желанию)",
                "Кунжут (для украшения) – 1 ч. л."
            ],
            "steps": [
                "Если рисовые палочки замороженные, разморозьте их и замочите в теплой воде на 10 минут.",
                "В небольшой миске смешайте гочуджан, гочугару, соевый соус, сахар и чеснок. Размешайте до однородной консистенции.",
                "В глубокой сковороде или кастрюле разогрейте растительное масло на среднем огне. Добавьте подготовленный соус и слегка обжарьте в течение 1 минуты, чтобы раскрыть аромат.",
                "Влейте воду в кастрюлю и доведите до кипения, постоянно помешивая, чтобы соус растворился.",
                "Добавьте рисовые палочки и рыбные пирожки. Уменьшите огонь и тушите, периодически помешивая, в течение 10-15 минут, пока рисовые палочки не станут мягкими и соус не загустеет.",
                "За 2 минуты до окончания приготовления добавьте нарезанный зеленый лук.",
                "Переложите токпокки на тарелку. Украсьте вареными яйцами и посыпьте кунжутом. Подавайте горячими."
            ],
            "image_url": "https://avatars.dzeninfra.ru/get-zen_doc/5255669/pub_62b4372bffe61d7b23c3096b_62b43b8e4719fe3d1ab46eed/scale_1200",
            "facts": "Токпокки – это популярное корейское уличное блюдо, которое изначально готовили в королевских дворцах. Со временем оно стало любимым уличным лакомством, а его пряный вкус покоряет гурманов по всему миру."
        },

        'Миёккук (суп с водорослями)': {
            'ingredients': [
                'Сушеные водоросли миёк (вакамэ) – 30 г',
                'Говядина (или курица, на выбор) – 150 г',
                'Соевый соус – 2 ст. ложки',
                'Чеснок – 2 зубчика (измельчить)',
                'Соль – по вкусу',
                'Вода – 1,5 литра',
                'Кунжутное масло – 1 ст. ложка'
            ],
            'steps': [
                'Замочите сушеные водоросли в холодной воде на 15-20 минут, чтобы они увеличились в размере. Затем слейте воду, слегка отожмите водоросли и нарежьте их на кусочки длиной около 5-7 см.',
                'Нарежьте говядину (или курицу) небольшими кусочками. Разогрейте кунжутное масло в кастрюле на среднем огне. Добавьте мясо и обжаривайте до изменения цвета, примерно 2-3 минуты.',
                'Положите подготовленные водоросли в кастрюлю к мясу. Добавьте измельченный чеснок и обжаривайте все вместе 2-3 минуты, чтобы водоросли пропитались ароматами.',
                'Залейте 1,5 литра воды в кастрюлю. Доведите до кипения на среднем огне.',
                'Добавьте соевый соус и немного соли. Перемешайте. Убавьте огонь до минимального и варите суп 20-30 минут.',
                'Разлейте суп по порционным тарелкам. Подавайте горячим с гарниром из риса.'
            ],
            'image_url': 'https://i.pinimg.com/originals/93/c8/33/93c83306ffa94a998807c165583c8dd0.jpg',
            'facts': 'Миёккук традиционно едят в Корее на день рождения, так как он символизирует здоровье и долголетие. Водоросли богаты железом и кальцием, что делает суп особенно полезным для женщин после родов.'
        }
    },
    'Французская': {
        'Французский луковый суп': {
            'ingredients': [
                'Лук репчатый - 1 кг',
                'Оливковое масло - 2 ст. ложки',
                'Сливочное масло - 50 г',
                'Сухое белое вино - 250 мл',
                'Говяжий бульон - 1 л',
                'Сахар - 1 ч. ложка',
                'Багет - 1 шт',
                'Твёрдый сыр (Грюйер или Пармезан) - 150 г',
                'Соль - по вкусу',
                'Чёрный молотый перец - по вкусу'
            ],
            'steps': [
                'Нарежьте лук тонкими полукольцами.',
                'Разогрейте оливковое и сливочное масло в глубокой сковороде или кастрюле на среднем огне.',
                'Добавьте лук и обжаривайте его на медленном огне, помешивая, около 25-30 минут, пока он не станет мягким и золотистым.',
                'Добавьте сахар, соль и перец. Перемешайте и готовьте ещё 5 минут.',
                'Влейте белое вино, увеличьте огонь и дайте алкоголю испариться, около 5 минут.',
                'Влейте горячий говяжий бульон и доведите суп до кипения. Уменьшите огонь и варите 20 минут.',
                'Тем временем нарежьте багет ломтиками и подсушите их в духовке до золотистого цвета.',
                'Натрите сыр на крупной тёрке.',
                'Разлейте суп по порционным жаропрочным тарелкам. На каждую порцию положите ломтик багета и посыпьте сыром.',
                'Запеките суп в разогретой до 200°C духовке около 5-7 минут, пока сыр не расплавится и не станет золотистым.',
                'Подавайте горячим.'
            ],
            'image_url': 'https://i.pinimg.com/originals/dd/48/5a/dd485ab9e0d9439eab50fb70c6a6385e.jpg',
            'facts': 'Французский луковый суп — классическое блюдо французской кухни. Он известен своим насыщенным вкусом и ароматом, а также хрустящей сырной корочкой на багете.'
        },

        "Французские круассаны": {
            "ingredients": [
                "Мука — 210 г",
                "Молоко — 85 мл",
                "Дрожжи — 5 г",
                "Сахар — 30 г",
                "Соль — 10 г",
                "Масло сливочное (мягкое) — 125 г",
                "Желток яйца — 1 шт."
            ],
            "steps": [
                "Разведите дрожжи в части молока. В остальном молоке растворите сахар и соль.",
                "Смешайте муку, молочную смесь и дрожжи. Замесите тесто. Оставьте на 2 часа для подъёма.",
                "Обомните тесто, раскатайте крестом, положите масло в центр и заверните края.",
                "Раскатайте тесто в прямоугольник, сложите втрое. Поверните на 90° и повторите. Уберите в холодильник на 1 час. Сделайте ещё 2 раскатки с охлаждением.",
                "Раскатайте тесто толщиной 6 мм, нарежьте треугольники, сверните их в круассаны.",
                "Разложите на противне, смажьте желтком, дайте подняться 1 час. Выпекайте при 180°C 20 минут."
            ],
            'image_url': 'https://www.tasteatlas.com/images/dishes/c743bfff128340e5b1a24f1e333f59f2.jpg?mw=1300',
            'facts': 'Несмотря на то, что круассаны стали символом французской кухни, их происхождение связано с Австрией. Первая версия круассана появилась в Вене и называлась "кифли". Французский вариант появился в начале 19 века благодаря венскому пекарю, открывшему пекарню в Париже. Именно там тесто стало слоёным, что и сделало круассан таким, каким мы знаем его сегодня.'
         }
    },
    'Испанская': {
        "Гаспачо (Испанский холодный суп)" : {
            'ingredients': [
                'Помидоры – 1 кг',
                'Огурец – 1 шт.',
                'Красный перец – 1 шт.',
                'Красный лук – 1/2 шт.',
                'Чеснок – 2 зубчика',
                'Оливковое масло – 50 мл',
                'Винный уксус – 2 ст.л.',
                'Белый хлеб (без корки) – 2 ломтика',
                'Соль – по вкусу',
                'Перец – по вкусу',
                'Ледяная вода – 150 мл'
            ],
            'steps': [
                'Обдайте помидоры кипятком, очистите от кожуры и удалите семена. Нарежьте крупными кусками.',
                'Огурец очистите от кожуры, удалите семена и нарежьте кусочками.',
                'У перца удалите семена и перегородки, нарежьте на куски.',
                'Лук, чеснок и хлеб тоже нарежьте.',
                'Смешайте все ингредиенты в блендере: помидоры, огурец, перец, лук, чеснок, хлеб, оливковое масло, уксус и ледяную воду.',
                'Взбейте до однородности. Посолите и поперчите по вкусу. Если суп слишком густой, добавьте немного воды.',
                'Уберите гаспачо в холодильник минимум на 2 часа, чтобы суп охладился и настоялся.',
                'Подавайте холодным, украсив свежими овощами, зеленью или каплей оливкового масла.'
            ],
            'image_url': 'https://goldniva.ru/upload/resize_cache/sprint.editor/826/1024_768_1/ls6687brp9rlo9ulammbzq1e4c70w933.jpeg',
            'facts': 'Гаспачо родом из южной Испании (Андалусия) и является освежающим блюдом, особенно популярным в жаркие летние дни.'
         },

        'Чуррос (Испанский десерт)':{
            'ingredients': [
                'Вода – 250 мл',
                'Мука пшеничная – 150 г',
                'Сливочное масло – 50 г',
                'Сахар – 1 ст.л.',
                'Щепотка соли',
                'Яйца – 2 шт.',
                'Растительное масло (для жарки) – 500 мл',
                'Сахарная пудра – для посыпки'
            ],
            'steps': [
                'В кастрюле доведите до кипения воду с добавлением сливочного масла, сахара и соли. Снимите с огня, добавьте муку и быстро перемешайте. Остудите.',
                'Добавьте яйца по одному, тщательно перемешивая тесто до однородности.',
                'Разогрейте растительное масло в глубокой сковороде до температуры 170-180°C.',
                'Переложите тесто в кондитерский мешок с насадкой-звездочкой. Выдавливайте полоски длиной 8-10 см прямо в масло.',
                'Обжаривайте чуррос до золотистого цвета (около 2-3 минут). Переложите на бумажные полотенца.',
                'Посыпьте готовые чуррос сахарной пудрой.',
                'Подавайте с шоколадным соусом или сгущённым молоком.'
            ],
            'image_url': 'https://keksonline.ru/upload/machaon/pagespeed/iblock/1b8/oz6l2kkdor8bfqgafe2in7bt8ykbvd89.jpeg.webp',
            'facts': 'Чуррос – популярный испанский десерт, который часто подают на завтрак с горячим шоколадом в зимние дни.'
        }
    }
}

favorites = {}


# Команда /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [
        [InlineKeyboardButton("Мировая кухня", callback_data="world_cuisines")],
        [InlineKeyboardButton("Favorites", callback_data="favorites")],
        [InlineKeyboardButton("Help", callback_data="help")]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text("Выберите действие:", reply_markup=reply_markup)


# Команда /help
async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "Доступные команды:\n"
        "/start - Главное меню\n"
        "/favorites - Показать избранные рецепты\n"
        "/help - Справка по командам\n"
        "Используйте кнопки для навигации."
    )
    if update.message:
        await update.message.reply_text(text)
    elif update.callback_query:
        await update.callback_query.message.reply_text(text)


# Показ списка мировых кухонь
async def world_cuisines(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.message.delete()
    keyboard = [
        [InlineKeyboardButton(f"Американская \ud83c\uddfa\ud83c\uddf8", callback_data="cuisine_Американская")],
        [InlineKeyboardButton(f"Грузинская \ud83c\uddec\ud83c\uddea", callback_data="cuisine_Грузинская")],
        [InlineKeyboardButton(f"Мексиканская \ud83c\uddf2\ud83c\uddfd", callback_data="cuisine_Мексиканская")],
        [InlineKeyboardButton(f"Индийская \ud83c\uddee\ud83c\uddf3", callback_data="cuisine_Индийская")],
        [InlineKeyboardButton(f"Итальянская \ud83c\uddee\ud83c\uddf9", callback_data="cuisine_Итальянская")],
        [InlineKeyboardButton(f"Русская \ud83c\uddf7\ud83c\uddfa", callback_data="cuisine_Русская")],
        [InlineKeyboardButton(f"Казахская \ud83c\uddf0\ud83c\uddff", callback_data="cuisine_Казахская")],
        [InlineKeyboardButton(f"Турецкая \ud83c\uddf9\ud83c\uddf7", callback_data="cuisine_Турецкая")],
        [InlineKeyboardButton(f"Японская \ud83c\uddef\ud83c\uddf5", callback_data="cuisine_Японская")],
        [InlineKeyboardButton(f"Узбекская \ud83c\uddfa\ud83c\uddff", callback_data="cuisine_Узбекская")],
        [InlineKeyboardButton(f"Корейская \ud83c\uddf0\ud83c\uddf7", callback_data="cuisine_Корейская")],
        [InlineKeyboardButton(f"Французская \ud83c\uddeb\ud83c\uddf7", callback_data="cuisine_Французская")],
        [InlineKeyboardButton(f"Испанская \ud83c\uddea\ud83c\uddf8", callback_data="cuisine_Испанская")]
    ]
    keyboard.append([InlineKeyboardButton("Назад", callback_data="back_to_main")])
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.message.reply_text("Выберите кухню:", reply_markup=reply_markup)


# Показ блюд конкретной кухни
async def cuisine_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query

    # Удаляем изображение, если оно существует
    if "photo_message_id" in context.user_data:
        try:
            await context.bot.delete_message(
                chat_id=query.message.chat_id,
                message_id=context.user_data["photo_message_id"]
            )
            del context.user_data["photo_message_id"]  # Удаляем идентификатор изображения из данных пользователя
        except Exception as e:
            print(f"Ошибка при удалении изображения: {e}")

    await query.message.delete()
    cuisine = query.data.split("_")[1]

    if cuisine in countries_data:
        keyboard = [
            [InlineKeyboardButton(dish, callback_data=f"dish_{cuisine}_{i}")]
            for i, dish in enumerate(countries_data[cuisine].keys())
        ]
        keyboard.append([InlineKeyboardButton("Назад", callback_data="back_to_main")])
        reply_markup = InlineKeyboardMarkup(keyboard)
        await query.message.reply_text(f"{cuisine} кухня:", reply_markup=reply_markup)


# Показ рецепта конкретного блюда
async def dish_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.message.delete()
    _, cuisine, dish_index = query.data.split("_")
    dish_index = int(dish_index)
    dish_name = list(countries_data[cuisine].keys())[dish_index]
    dish_data = countries_data[cuisine][dish_name]

    # Form the text
    text = f"<b>{dish_name}</b>\n\n"
    text += f"<b>Ингредиенты:</b>\n" + "\n".join(f"- {i}" for i in dish_data['ingredients']) + "\n\n"
    text += f"<b>Способ приготовления:</b>\n" + "\n".join(
        f"{i + 1}. {step}" for i, step in enumerate(dish_data['steps'])) + "\n\n"
    text += f"<b>Интересный факт:</b> {dish_data['facts']}"

    # Buttons
    keyboard = [
        [InlineKeyboardButton("Добавить в избранное", callback_data=f"favorite_{cuisine}_{dish_index}")],
        [InlineKeyboardButton("Назад", callback_data=f"cuisine_{cuisine}")],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    # Send photo and store its message_id
    photo_message = await query.message.reply_photo(photo=dish_data['image_url'])
    context.user_data["photo_message_id"] = photo_message.message_id

    # Send text with buttons
    await query.message.reply_text(text, parse_mode="HTML", reply_markup=reply_markup)


# Добавление в избранное
async def add_to_favorites(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    _, cuisine, dish_index = query.data.split("_")
    dish_name = list(countries_data[cuisine].keys())[int(dish_index)]
    user_id = query.from_user.id

    if user_id not in favorites:
        favorites[user_id] = []
    if dish_name not in favorites[user_id]:
        favorites[user_id].append(dish_name)
        await query.answer("Добавлено в избранное!")
    else:
        await query.answer("Это блюдо уже в избранном!")


# Показ рецепта из избранного
async def favorite_recipe_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.message.delete()
    _, dish_callback = query.data.split("_recipe_")

    # Восстанавливаем название блюда из callback_data
    dish_name = dish_callback.replace("_", " ")

    # Ищем блюдо в списке данных
    for cuisine, dishes in countries_data.items():
        if dish_name in dishes:  # Проверяем, есть ли блюдо в текущей кухне
            dish_data = dishes[dish_name]
            text = f"<b>{dish_name}</b>\n\n"
            text += f"<b>Ингредиенты:</b>\n" + "\n".join(f"- {i}" for i in dish_data['ingredients']) + "\n\n"
            text += f"<b>Способ приготовления:</b>\n" + "\n".join(
                f"{i + 1}. {step}" for i, step in enumerate(dish_data['steps'])) + "\n\n"
            text += f"<b>Интересный факт:</b> {dish_data['facts']}"

            keyboard = [[InlineKeyboardButton("Назад", callback_data="favorites")]]
            reply_markup = InlineKeyboardMarkup(keyboard)
            await query.message.reply_text(text, parse_mode="HTML", reply_markup=reply_markup)
            return

    # Если блюдо не найдено
    await query.message.reply_text("Рецепт не найден.")


# Показ избранного
async def show_favorites(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_id = update.message.from_user.id if update.message else update.callback_query.from_user.id

    if user_id in favorites and favorites[user_id]:
        keyboard = [
            [InlineKeyboardButton(dish, callback_data=f"favorite_recipe_{dish.replace(' ', '_')}")]
            for dish in favorites[user_id]
        ]
        keyboard.append([InlineKeyboardButton("Назад", callback_data="back_to_main")])
        reply_markup = InlineKeyboardMarkup(keyboard)

        if update.message:
            await update.message.reply_text("Ваши избранные блюда:", reply_markup=reply_markup)
        else:
            await update.callback_query.message.reply_text("Ваши избранные блюда:", reply_markup=reply_markup)
    else:
        text = "Ваш список избранного пуст."
        if update.message:
            await update.message.reply_text(text)
        else:
            await update.callback_query.message.reply_text(text)


# Возврат в главное меню
async def back_to_main(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query

    # Delete the stored photo message if it exists
    if "photo_message_id" in context.user_data:
        try:
            await context.bot.delete_message(
                chat_id=query.message.chat_id,
                message_id=context.user_data["photo_message_id"]
            )
            del context.user_data["photo_message_id"]  # Remove it from user_data
        except Exception as e:
            print(f"Error deleting photo message: {e}")

    # Delete the current message and go back to the main menu
    await query.message.delete()
    keyboard = [
        [InlineKeyboardButton("Мировая кухня", callback_data="world_cuisines")],
        [InlineKeyboardButton("Favorites", callback_data="favorites")],
        [InlineKeyboardButton("Help", callback_data="help")],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    await query.message.reply_text("Выберите действие:", reply_markup=reply_markup)


# Основной запуск бота
def main():
    application = Application.builder().token('7753581322:AAEKVpjUvs3oU9Sdnhb2QEJdgKtH1RK29NQ').build()

    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(CommandHandler("favorites", show_favorites))
    application.add_handler(CallbackQueryHandler(favorite_recipe_handler, pattern="^favorite_recipe_"))
    application.add_handler(CallbackQueryHandler(world_cuisines, pattern="^world_cuisines$"))
    application.add_handler(CallbackQueryHandler(cuisine_handler, pattern="^cuisine_"))
    application.add_handler(CallbackQueryHandler(dish_handler, pattern="^dish_"))
    application.add_handler(CallbackQueryHandler(add_to_favorites, pattern="^favorite_"))
    application.add_handler(CallbackQueryHandler(back_to_main, pattern="^back_to_main$"))
    application.add_handler(CallbackQueryHandler(help_command, pattern="^help$"))
    application.add_handler(CallbackQueryHandler(show_favorites, pattern="^favorites$"))

    application.run_polling()


if __name__ == "__main__":
    main()
